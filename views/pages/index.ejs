<!-- views/pages/index.ejs -->

<!DOCTYPE html>
<html lang="en">
<head>
    <% include ../partials/head %>
</head>
<body>
<div class="uk-container uk-container-center uk-margin-large-bottom">
    <header>
		<% include ../partials/header %>
    </header>

    <main>
	<div class="uk-grid uk-margin-top">
		<div class="uk-width-small-1-1"><br/></div>
		<div class="uk-width-small-7-10">
			<div class="uk-panel uk-panel-box uk-panel-box-secondary" style="min-height:150px;">
				<h3 class="uk-panel-title"><i class="uk-icon-group"></i> Current Players</h3>
					<script src="/js/game/lobbylist.js"></script>

					<table>
					<%
						var count = 0;
						for (i = 0; i < onUsers.length; i++) {
							
							if (count === 0) { %>
								<tr>
									<td><button onclick=<%- ((!user) ? '\"javaScript:void(0);\"' : ((String(user._id) == String(onUsers[i]._id) && onUsers[i].local.status === 0) ? '\"javaScript:void(0);\"' : '\"addPlayer(this.value,\'' + onUsers[i].local.username + '\')\"' ))%> class="uk-button uk-button-mini" type="button" value="<%-onUsers[i]._id%>"><i class="uk-icon-user" style="color:<%-((onUsers[i].local.status === 1) ? "#D7DF01" : ((onUsers[i].local.status === 2) ? "#B40404": "#31B404")) %>"></i> <%-onUsers[i].local.username%> </button></td>
							<% count += 1; } else if (count < 4 && count > 0) { %>
									<td><button onclick=<%- ((!user) ? '\"javaScript:void(0);\"' : ((String(user._id) == String(onUsers[i]._id) && onUsers[i].local.status === 0) ? '\"javaScript:void(0);\"' : '\"addPlayer(this.value,' + onUsers[i].local.username + ')\"' ))%> class="uk-button uk-button-mini" type="button" value="<%-onUsers[i]._id%>"><i class="uk-icon-user" style="color:<%-((onUsers[i].local.status === 1) ? "#D7DF01" : ((onUsers[i].local.status === 2) ? "#B40404": "#31B404")) %>"></i> <%-onUsers[i].local.username%> </button></td>
							<% count += 1; } else { %>
									<td><button onclick=<%- ((!user) ? '\"javaScript:void(0);\"' : ((String(user._id) == String(onUsers[i]._id) && onUsers[i].local.status === 0) ? '\"javaScript:void(0);\"' : '\"addPlayer(this.value,' + onUsers[i].local.username + ')\"' ))%> class="uk-button uk-button-mini" type="button" value="<%-onUsers[i]._id%>"><i class="uk-icon-user" style="color:<%-((onUsers[i].local.status === 1) ? "#D7DF01" : ((onUsers[i].local.status === 2) ? "#B40404": "#31B404")) %>"></i> <%-onUsers[i].local.username%> </button></td>
									</tr>
							<% count = 0; };
						}
					%>
					</table>
			</div>
		</div>
		<div class="uk-width-small-3-10">
			<div class="uk-panel uk-panel-box uk-panel-box-secondary" style="min-height:150px;">
				<h3 class="uk-panel-title" ><i class="uk-icon-flask"></i> <span id="playerCount">Create Game</span></h3>
					<ul class="uk-list" id="setupList">
					
					</ul>
			</div>
		</div>
		<div class="uk-width-small-1-1"><br/></div>
		<div class="uk-width-small-1-1">
			<div class="uk-panel uk-panel-box uk-panel-box-secondary">
				<h3 class="uk-panel-title"><i class="uk-icon-laptop"></i> Current Games</h2>
				No current games
			</div>
		</div>
		<div class="uk-width-small-1-1"><br/></div>
		<div class="uk-width-small-1-1">
			<div class="uk-panel uk-panel-box uk-panel-box-secondary">
				<script>
				var socket = io();

				document.addEventListener('DOMContentLoaded', function() {
					document.forms['lobby-form'].addEventListener('submit', function(e) {
						e.preventDefault();
						var timestamp = new Date().getTime();
						var msg = [timestamp , <% if (typeof user !== "undefined" && user) { %> '[<%= user.local.username %>' <% } %> + "] " + document.getElementById('lobby-txt').value];
						socket.emit('chat message', msg);
						document.getElementById('lobby-txt').value = '';
						return false;
					});
				});

				socket.on('chat message', function(msg) {
					console.log(msg);
					var timestamp = msg[0];
					timestamp = moment.utc(timestamp).toDate();
					timestamp = moment(timestamp).format('HH:mm:ss');
					
					$('#lobby-win').append($('<li>').append("<span class='uk-text-muted uk-text-small'>" + timestamp + "</span>" + " " + msg[1]));
					document.getElementById('lobby-win').scrollTop = document.getElementById('lobby-win').scrollHeight;
				});
				</script>
				<div class="uk-panel">
					<h3 class="uk-panel-title"><i class="uk-icon-desktop"></i> Dominion Lobby</h3>
				</div>
				<div id="lobby-win" class="uk-panel uk-width-1-1 uk-panel-box uk-panel-box-secondary" style="height: 200px; overflow: auto;">

				</div>
				<form class="uk-form" id="lobby-form" action="">
					<fieldset data-uk-margin>
						<div class="uk-form-row uk-panel-box-secondary"></div>
							<input id="lobby-txt" type="text" placeholder="Start typing..." class="uk-width-9-10 uk-grid-collapse uk-form-blank" autocomplete="off" <%if (typeof user !== "undefined" && user) { } else { %>disabled<% } %>>
							<button class="uk-button uk-button-primary" style="float:right;" <%if (typeof user !== "undefined" && user) { } else { %>disabled<% } %>><i class="uk-icon-share"></i> Send</button>
						</div>
					</fieldset>
				</form>
			</div>
		</div>
		<footer>
        <% include ../partials/footer %>
		</footer>
	</div>
    </main>
</div>    
</body>
</html>
