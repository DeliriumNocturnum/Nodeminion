<!-- views/pages/game.ejs -->
<!DOCTYPE html>
<html>
<head>
  <% include ../partials/head %>
  <script>
    var gameDeck = {};
    var gameJSON = <%-JSON.stringify(gamedeck)%>;
    for (var attr in gameJSON) {
      gameDeck[attr] = gameJSON[attr];
    }
  </script>
  <script src="/js/game/game.js"></script>
  <script>
  var socket = io();
  var gameId = '<%- gameid %>';
  var user = <% if (typeof user !== "undefined" && user) { %><%- '"' + String(user.local.username) + '"'%><% } %>;  
  document.addEventListener('DOMContentLoaded', function() {
    <%if (typeof user !== "undefined" && user) { %>socket.emit('send user', '<%-user._id%>');<%} %>

    document.forms['private-lobby-form'].addEventListener('submit', function(e) {
      e.preventDefault();
      var timestamp = new Date().getTime();
      var msg = [timestamp , '[' + user + '] ' + document.getElementById('private-lobby-txt').value];
      socket.emit('game message', msg, gameId);
      document.getElementById('private-lobby-txt').value = '';
      return false;
    });
  });
  </script>
  <style>
    ul, li {
        font-family:'verdana';
    }
    li {
        font-size: 8pt;
    }
    ul {
        list-style-position: inside;
        list-style-type: none;
    }
    #victory, #treasure, div.kingdom {
        float: left;
        margin-left: -15px;
    }

    button.victory,button.treasure,button.kingdom,button.curse {
        cursor: pointer;
        margin-bottom: 2px;
        width:75px;
        font-size: 8pt
    }
    button.victory {
        background-color: #82FA58;
        border: 1px solid #000;
    }
    #cardDisplay {
        clear: both;
        width: 200px;
        height: 250px;
        margin: 15px;
        border: 1px solid #000;
    }
    button.treasure {
        background-color: #F3F781;
        border: 1px solid #000;
    }
    button.kingdom {
        border: 1px solid #1C1C1C;
    }
    button.curse {
        background-color: #CC2EFA;
        border: 1px solid #000;
    }
  </style>
</head>
<body>
<div class="uk-container uk-container-center uk-margin-large-bottom">
  <header>
    <% include ../partials/header %>
  </header>
  <main ng-app="cardStore" ng-controller="CardController as cards">
    <div class="uk-grid uk-grid-collapse">
      <div class="uk-width-1-5">
        <div class="uk-panel uk-panel-space" style="height:100px;">
          <div class="uk-panel-header"><h4 class="uk-panel-title"><i class="uk-icon-trophy"></i> Victory</h4></div>
          <ul>
            <li ng-repeat="card in cards.victory | orderBy:'-cost'" ng-if="card.count > 0">
              <table>
                <tr>
                  <td width="50px">({{card.count}})</td>
                  <td><button class="victory">{{card.name}}</button></td>
                  <td>${{card.cost}}</td>
                </tr>
              </table>
            </li>
            <li ng-repeat="card in cards.curse | orderBy:'-cost'" ng-if="card.count > 0">
              <table>
                <tr>
                  <td width="50px">({{card.count}})</td>
                  <td><button class="curse">{{card.name}}</button></td>
                  <td>${{card.cost}}</td>
                </tr>
              </table>
            </li>
          </ul>
        </div>
      </div>
      <div class="uk-width-1-5">
        <div class="uk-panel uk-panel-space" style="height:100px;">
          <div class="uk-panel-header"><h4 class="uk-panel-title"><i class="uk-icon-money"></i> Treasure</h4></div>
          <ul>
            <li ng-repeat="card in cards.treasure | orderBy:'-cost'" ng-if="card.count > 0">
              <table>
                <tr>
                  <td width="25px">({{card.count}})</td>
                  <td><button class="treasure">{{card.name}}</button></td>
                  <td>${{card.cost}}</td>
                </tr>
              </table>
            </li>
          </ul>
        </div>
      </div>
      <div class="uk-width-3-5">
        <div class="uk-panel uk-panel-space" style="height:100px;">
          <div class="uk-panel-header"><h4 class="uk-panel-title"><i class="uk-icon-shield"></i> Kingdom</h4></div>
            <div class='kingdom'>
              <ul>
                  <li ng-repeat="card in cards.kingdom | orderBy: '-cost' | slice:0:5">
                    <table>
                      <tr>
                        <td width="25px">({{card.count}})</td>
                        <td><button class='kingdom' ng-mouseover="$parent.name=each.name;$parent.cost=each.cost;$parent.text=each.text;$parent.visible=true;$parent.cardColor=card.color" ng-mouseleave="$parent.visible=false;$parent.name='';$parent.text='';$parent.cost=''" style="background-color:{{card.color}};">{{card.name}}</button></td>
                        <td>${{card.cost}}</td>
                      </tr>
                    </table>
                  </li>
              </ul>
          </div>
          <div class='kingdom'>
              <ul>
                <li ng-repeat="card in cards.kingdom | orderBy: '-cost' | slice:5:10">
                  <table>
                    <tr>
                      <td width="25px">({{card.count}})</td>
                      <td><button class='kingdom' ng-mouseover="$parent.name=each.name;$parent.cost=each.cost;$parent.text=each.text;$parent.visible=true;$parent.cardColor=card.color" ng-mouseleave="$parent.visible=false;$parent.name='';$parent.text='';$parent.cost=''" style="background-color:{{card.color}};">{{card.name}}</button></td>
                      <td>${{card.cost}}</td>
                    </tr>
                  </table>
                </li>
              </ul>
          </div>
        </div>
      </div>
      <div class="uk-width-4-5">
        <div class="uk-panel uk-panel-space" style="height:300px;">
          <div class="uk-panel-header"><h4 class="uk-panel-title"><i class="uk-icon-photo"></i> Play Area</h4></div>
        </div>
      </div>
      <div class="uk-width-1-5">
        <div class="uk-panel uk-panel-space" style="height:300px;">
          <div class="uk-panel-header"><h4 class="uk-panel-title"><i class="uk-icon-gamepad"></i> Controls</h4></div>
        </div>
      </div>
      <div class="uk-width-3-6">
        <div class="uk-panel uk-panel-space">
          <h4 class="uk-panel-title"><i class="uk-icon-comments-o"></i> Private Lobby</h4>
          <div id="private-lobby" class="uk-panel uk-width-1-1 uk-panel-box uk-panel-box-secondary" style="height:150px; overflow: auto;">
            <ul class="uk-list">
            
            </ul>
          </div>
          <form class="uk-form" id="private-lobby-form" action="">
            <fieldset data-uk-margin>
              <div class="uk-form-row uk-panel-box-secondary">
                <input id="private-lobby-txt" type="text" placeholder="Start typing..." class="uk-width-2-3 uk-form-blank" autocomplete="off" <%if (typeof user !== "undefined" && user) { } else { %>disabled<% } %>>
                <button class="uk-button uk-button-primary" style="float:right;" <%if (typeof user !== "undefined" && user) { } else { %>disabled<% } %>><i class="uk-icon-share"></i> Send</button>
              </div>
            </fieldset>
          </form>
        </div>
      </div>
      <div class="uk-width-3-6">
        <div class="uk-panel uk-panel-space" style="height:175px;">
          <h4 class="uk-panel-title"><i class="uk-icon-history"></i> History</h4>
          <div id="private-history" class="uk-panel uk-width-1-1 uk-panel-box uk-panel-box-secondary" style="height:150px; overflow: auto;">

          </div>
          <button onclick="javaScript:void(0);" class="uk-button uk-button-danger" style="float:right;"><i class="uk-icon-exclamation"></i> Quit</button>
          <button onclick="javaScript:void(0);" class="uk-button uk-button-danger" style="float:right;margin-right:5px;"><i class="uk-icon-user-times"></i> Kick</button>
        </div>
      </div>
    </div>
  </main>
</div>
</body>
</html>